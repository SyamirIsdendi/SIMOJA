<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Monitoring Kumbung Jamur</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="FOTO/FOTO LOGO/simojapng.png">

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <!-- Firebase Config -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDe_WxXPw2OPlkSn1YDhIjeR8Jz4gIedT0",
      authDomain: "sensor-c6fe3.firebaseapp.com",
      databaseURL: "https://sensor-c6fe3-default-rtdb.firebaseio.com",
      projectId: "sensor-c6fe3",
      storageBucket: "sensor-c6fe3.appspot.com",
      messagingSenderId: "916474546319",
      appId: "1:916474546319:web:10f3b52d8c193c4ba2c8fa"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <!-- Swiper CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <link rel="stylesheet" href="swiper-custom.css" />

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Tambahkan Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="site-fixed-size">
    <header class="header">
      <div class="logo" style="justify-content: flex-start; flex: 1;">
        <img src="FOTO/FOTO LOGO/simojapng.png" alt="Logo" class="logo-img">
        <h1>SIMOJA</h1>
      </div>
      <button class="navbar-toggler d-md-none" id="navbarToggler" aria-label="Menu">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>
    </header>

    <nav class="navbar">
      <ul class="navbar-menu">
        <li><a href="#" onclick="showSection('beranda')">Beranda</a></li>
        <li><a href="#" onclick="showSection('monitoring')">Monitoring</a></li>
        <li><a href="#" onclick="showSection('lokasi')">Lokasi</a></li>
      </ul>
      <button id="logout-btn" class="btn btn-warning ms-3 navbar-logout d-none d-md-inline-block" style="font-weight:600;border-radius:20px;padding:8px 22px;box-shadow:0 2px 8px rgba(241,196,15,0.13);">Logout</button>
      <div class="navbar-mobile-menu" id="navbarMobileMenu">
        <a href="#" onclick="showSection('beranda');toggleMobileMenu();">Beranda</a>
        <a href="#" onclick="showSection('monitoring');toggleMobileMenu();">Monitoring</a>
        <a href="#" onclick="showSection('lokasi');toggleMobileMenu();">Lokasi</a>
        <a href="#" onclick="showSection('contact');toggleMobileMenu();">Contact Us</a>
        <button id="logout-btn-mobile" class="btn btn-warning w-100 mt-2" style="font-weight:600;border-radius:20px;padding:8px 0;">Logout</button>
      </div>

      <!-- Tambahkan Contact Us ke navbar desktop -->
      <ul class="navbar-menu navbar-menu-right">
        <li><a href="#" onclick="showSection('contact')">Contact Us</a></li>
      </ul>

      <!-- Section Contact Us -->
      <section id="contact" style="display:none;">
        <div class="contact-hero">
          <h2>Terima Kasih Telah Menghubungi Kami!</h2>
          <p>Kami sangat berterimakasih atas saran dan kritik yang anda berikan.</p>
        </div>
        <div class="contact-cards">
          <div class="contact-card">
            <div class="contact-icon"><span style="font-size:2.2rem;">&#128172;</span></div>
            <h3>Kritik dan Saran</h3>
            <p>Kami terbuka untuk masukan, kritik, dan saran Anda demi pengembangan sistem yang lebih baik.</p>
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSeB3HffaW53SG_YPXUbc7Ma4ddWAB7_1lnfjaIEN_IEQwgHjg/viewform?usp=sharing&ouid=110590131760065842309" class="contact-btn" target="_blank" rel="noopener">Isi Form Kritik & Saran</a>
          </div>
        </div>
      </section>
    </nav>

    <main class="main-layout">
      <div class="content-area">
        <section id="beranda" style="display: block;">
          <div class="beranda-bg"></div>
          <div class="beranda-bg-overlay"></div>
          <div class="beranda-content container-fluid px-2 px-md-4 py-3">
            <h2 class="text-center mb-4">Selamat Datang di Sistem Monitoring Kumbung Jamur</h2>
            <div class="row justify-content-center mb-4">
              <div class="col-12 col-md-8">
                <div class="swiper beranda-swiper rounded-4 overflow-hidden shadow-sm">
                  <div class="swiper-wrapper">
                    <div class="swiper-slide"><a href="https://finance.detik.com/foto-bisnis/d-7776830/panen-jamur-tiram-di-desa-karang-malang-sragen" target="_blank" rel="noopener"><img src="FOTO/FOTO BERITA/Panen Jamur Tiram di Desa Karang Malang Sragen.jpg" alt="Jamur 1"></a></div>
                    <div class="swiper-slide"><a href="https://www.liputan6.com/tv/read/5016919/video-berani-berubah-si-jamur-tiram-modal-kecil-untung-besar" target="_blank" rel="noopener"><img src="FOTO/FOTO BERITA/BUDIDAYA JAMUR TIRAM, MODAL KECIL CUAN BESAR.jpg" alt="Budidaya Jamur Tiram, Modal Kecil Cuan Besar"></a></div>
                    <div class="swiper-slide"><a href="https://sumatra.bisnis.com/read/20250622/534/1887147/peluang-pasar-terbuka-lebar-pengusaha-jamur-tiram-palembang-genjot-produksi" target="_blank" rel="noopener"><img src="FOTO/FOTO BERITA/Peluang Pasar Terbuka Lebar, Pengusaha Jamur Tiram Palembang Genjot Produksi.jpg" alt="Peluang Pasar Terbuka Lebar, Pengusaha Jamur Tiram Palembang Genjot Produksi"></a></div>
                    <div class="swiper-slide"><a href="https://ppid.pertanian.go.id/doc/1/Budidaya/Budidaya%20Jamur%20Tiram.pdf" target="_blank" rel="noopener"><img src="FOTO/FOTO BERITA/SOP BUDIDAYA JAMUR TIRAM.jpg" alt="SOP Budidaya Jamur Tiram"></a></div>
                    <div class="swiper-slide"><a href="https://www.youtube.com/results?search_query=Budidaya+Jamur+Tiram+Mulai+dari+Nol%3A+Panen+Setiap+Hari%2C+Untung+Berkali-kali" target="_blank" rel="noopener"><img src="FOTO/FOTO BERITA/Budidaya Jamur Tiram Mulai dari Nol Panen Setiap Hari, Untung Berkali-kali.jpg" alt="Budidaya Jamur Tiram Mulai dari Nol Panen Setiap Hari, Untung Berkali-kali"></a></div>
                    <div class="swiper-slide"><a href="https://hortikultura.pertanian.go.id/budidaya-jamur-punya-potensi-ekspor-tinggi-permintaan-terus-meningkat/" target="_blank" rel="noopener"><img src="FOTO/FOTO BERITA/Budidaya Jamur Punya Potensi Ekspor Tinggi, Permintaan Terus Meningkat.jpg" alt="Budidaya Jamur Punya Potensi Ekspor Tinggi, Permintaan Terus Meningkat"></a></div>
                    <div class="swiper-slide"><a href="https://batampos.jawapos.com/berita/2424616049/coffebilitas-hadir-di-batam" target="_blank" rel="noopener"><img src="FOTO/FOTO BERITA/Coffebilitas, Hadir di Batam.jpg" alt="Coffebilitas, Hadir di Batam"></a></div>
                    <div class="swiper-slide"><a href="https://www.rri.co.id/umkm/509817/istana-jamur-di-batam-suguhkan-konsep-berbeda" target="_blank" rel="noopener"><img src="FOTO/FOTO BERITA/Istana Jamur di Batam Suguhkan Konsep Berbeda.jpg" alt="Istana Jamur di Batam Suguhkan Konsep Berbeda"></a></div>
                  
                  </div>
                  <div class="swiper-pagination"></div>
                  <div class="swiper-button-prev"></div>
                  <div class="swiper-button-next"></div>
                </div>
              </div>
            </div>
            <div class="row justify-content-center mb-4">
              <div class="col-12 col-md-10 col-lg-8">
                <div class="artikel-container card border-0 shadow-sm mb-3">
                  <div class="artikel-content card-body" style="text-align:justify;">
                    <h3 class="card-title text-center mb-3">Istana Jamur Cafebilitas, Kafe Baru di Batam yang Ramah Disabilitas</h3>
                    <p>Istana Jamur Cafebilitas merupakan produk hilirisasi dari Yayasan Putra Kami yang menaungi empat Sekolah Luar Biasa (SLB) di wilayah Kepulauan Riau (Kepri). Empat SLB tersebut yakni, SLB Putrakami dan SLB Anak Brilliant di Batam, SLB Mutiara di Tanjungpinang, dan SLB Sehati di Karimun.</p>
                    <p>Kafe ini dikondisikan ramah disabilitas, contohnya dengan mewujudkan alternatif komunikasi menggunakan bahasa isyarat. Sebagai educenter, Istana Jamur Cafebilitas juga menyediakan produk-produk pelatihan Bisindo bersama teman tuli maupun pelatihan tenaga kerja bagi disabilitas.</p>
                    <p>"Kami punya cita-cita, anak-anak yang lulus SLB bisa siap dengan dunia kerja, agar lebih mandiri dan punya aktivitas," ujar Tiara. Menurutnya, penyediaan akses terhadap pendidikan bagi penyandang disabilitas saja tidak cukup. Diperlukan wadah dan fasilitas yang memungkinkan para penyandang disabilitas untuk bekerja dan beraktivitas seperti orang kebanyakan.</p>
                    <p>Di kafe ini, para penyandang disabilitas bisa bekerja di bidang kuliner dan pelayanan (hospitality). Sesuai namanya Istana Jamur, maka menu-menu yang disediakan di sini adalah aneka makanan olahan jamur. Ada Jamur Crispy, Bakwan Jamur, Dimsum Jamur, Ayam Geprek Sambal Jamur, Bakso Jamur, dan masih banyak lagi.</p>
                    <p>Jamur yang dipakai yakni jamur tiram. Bahan baku ini diperoleh secara swasembada, yakni dari kumbung jamur yang didirikan di dekat area kafe. Di kumbung inilah jamur-jamur setiap hari dipanen, kemudian diolah di dapur Istana Jamur untuk disantap oleh para pengunjung.</p>
                    <p>"Jamur relatif mudah dibudidaya. Selain makanan-makanan di kafe, kami juga punya usaha makanan kalengan rendang jamur yang sudah berkualitas ekspor," tambah Tiara. Sebagai agrowisata, Istana Jamur juga bisa dikunjungi untuk melihat langsung proses budidaya jamur tiram di lokasi.</p>
                    <p>Pengunjung juga bisa memetik jamur-jamur yang sudah siap panen, dan bahkan mengikuti kelas memasak cara mengolah jamur tersebut. Sebagai tempat nongkrong baru di Batam, Istana Jamur Cafebilitas tergolong sebagai paket lengkap.</p>
                    <p>Kafe ini buka setiap hari dari pukul 10:00 WIB sampai 21:00 WIB. Bagi pengunjung yang datang untuk bekerja atau mengadakan pertemuan, Istana Jamur juga menyediakan meeting room. Harapannya kafe ini terus ramai, sehingga kami bisa lebih banyak merekrut teman-teman disabilitas untuk bekerja di sini.</p>
                    <p>Dengan konsep inklusif dan edukatif, Istana Jamur Cafebilitas tidak hanya menjadi tempat makan, tetapi juga ruang pemberdayaan dan pembelajaran bagi masyarakat, khususnya penyandang disabilitas di Batam dan sekitarnya.</p>
                    <p style="text-align:center;margin-top:1.2em;font-size:1.01rem;">
                      <span style="color:#e67e22;font-weight:600;">🔗 Sumber artikel:</span> 
                      <a href="https://batam.tribunnews.com/2024/02/18/istana-jamur-cafebilitas-kafe-baru-di-batam-yang-ramah-disabilitas" target="_blank" rel="noopener" style="color:#3498db;text-decoration:underline;font-weight:500;">batam.tribunnews.com</a>
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="row justify-content-center mb-4">
              <div class="col-12 col-md-6 col-lg-4">
                <div class="barcode-section card border-0 shadow-sm text-center py-3">
                  <div class="barcode-container">
                    <img src="FOTO/FOTO BARCODE/BARCODE APK SIMOJA.jpg" alt="Barcode Download Aplikasi" class="barcode-img img-fluid mb-2" style="max-width:180px;">
                    <div class="fw-bold"><a href="https://drive.google.com/drive/folders/1ALDRo_SYDi3QR7lC6P7f2NoT3OVuB3Ip" target="_blank" rel="noopener">Download aplikasi di sini!</a></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="monitoring" style="display: none;">
          <h2>Monitoring Kumbung Jamur</h2>
          <div class="card card-monitoring">
            <div class="monitor-row">
              <div class="monitor-item suhu">
                <span class="icon">🌡</span>
                <span class="label">Suhu</span>
                <span class="value" id="temp">--</span>
                <span class="unit">°C</span>
              </div>
              <div class="monitor-item humidity">
                <span class="icon">💧</span>
                <span class="label">Kelembaban</span>
                <span class="value" id="humidity">--</span>
                <span class="unit">%</span>
              </div>
              <div class="monitor-item arus">
                <span class="icon">⚡</span>
                <span class="label">Arus</span>
                <span class="value" id="current">--</span>
                <span class="unit">mA</span>
              </div>
              <div class="monitor-item relay">
                <span class="icon">🔌</span>
                <span class="label">Status Relay</span>
                <span class="relay-badge" id="relay">--</span>
              </div>
            </div>
          </div>
          <div class="card">
            <h3>Grafik Monitoring Sensor</h3>
            <canvas id="chart-suhu"></canvas>
            <canvas id="chart-humidity"></canvas>
            <canvas id="chart-arus"></canvas>
            <canvas id="chart-relay"></canvas>
          </div>
        </section>

        <section id="lokasi" style="display: none;">
          <h2>Lokasi Kumbung Jamur</h2>
          <div class="maps-container">
            <div class="map-item lokasi-card">
              <h3>Kumbung Istana Jamur</h3>
              <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d249.31528114732433!2d104.06432402056804!3d1.128466372814731!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31d989a1fea5227d%3A0xe0cd667354931761!2sIstana%20Jamur!5e0!3m2!1sid!2us!4v1747798810346!5m2!1sid!2us" width="100%" height="350" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
          </div>
        </section>
      </div>
    </main>
    <!-- SIDEBAR DIPINDAH KE BAWAH -->
    <footer class="sidebar sidebar-bawah">
      <h3>Ikuti Sosial Media</h3>
      <ul>
        <li><a href="https://www.instagram.com/istanajamur_cafebilitas/" target="_blank" rel="noopener"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram" style="width:22px;vertical-align:middle;margin-right:8px;">istanajamur_cafebilitas</a></li>
        <li><a href="https://www.instagram.com/simokti.pkmpi/" target="_blank" rel="noopener"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram" style="width:22px;vertical-align:middle;margin-right:8px;">simokti.pkmpi</a></li>
        <li><a href="https://www.instagram.com/instrumentasi_polibatam/" target="_blank" rel="noopener"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram" style="width:22px;vertical-align:middle;margin-right:8px;">instrumentasi_polibatam</a></li>
        <li><a href="https://www.instagram.com/polibatamofficial/" target="_blank" rel="noopener"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" alt="Instagram" style="width:22px;vertical-align:middle;margin-right:8px;">polibatamofficial</a></li>
      </ul>
      <hr>
      <div>Introduction Our Team!</div>
      <div class="anggota-tim">
        <div class="anggota-item">
          <img src="FOTO/FOTO TIM/PAK KAMAR.jpg" alt="Manpro">
          <div class="anggota-info">
            <div> Ir.Kamarudin,S.T., M.T., IPM</div>
            <div>Manpro</div>
          </div>
        </div>
        <div class="anggota-item">
          <img src="FOTO/FOTO TIM/FARHAN.jpg" alt="Ketua">
          <div class="anggota-info">
            <div>Farhan Arfachrudin</div>
            <div>Ketua Kelompok</div>
          </div>
        </div>
        <div class="anggota-item">
          <img src="FOTO/FOTO TIM/RAKA.jpg" alt="Anggota">
          <div class="anggota-info">
            <div>M Galih Raka Yanuardi</div>
            <div>Anggota</div>
          </div>
        </div>
        <div class="anggota-item">
          <img src="FOTO/FOTO TIM/SYAMIR.jpg" alt="Anggota">
          <div class="anggota-info">
            <div>Syamir Isdendi</div>
            <div>Anggota</div>
          </div>
        </div>
        <div class="anggota-item">
          <img src="FOTO/FOTO TIM/BAMBANG.jpg" alt="Anggota">
          <div class="anggota-info">
            <div>Bambang Fadhila Yusuf</div>
            <div>Anggota</div>
          </div>
        </div>
      </div>
      <hr>
      <div>Dashboard Monitoring Kumbung Jamur<br>v1.0</div>
    </footer>

    <div id="privacy-popup">
      <div>
        <h2>Privacy & Policy</h2>
        <p>Dashboard ini menggunakan data sensor dan informasi pengguna hanya untuk keperluan monitoring dan pengembangan sistem. Data tidak akan dibagikan ke pihak ketiga. Dengan menggunakan dashboard ini, Anda menyetujui kebijakan privasi kami.</p>
        <button id="privacy-accept">Saya Mengerti</button>
      </div>
    </div>
  </div>

  <!-- Swiper JS -->
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
  <!-- Tambahkan Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Tampilkan privacy popup hanya jika belum pernah disetujui di sesi ini
      if (sessionStorage.getItem('privacyAccepted') === 'true') {
        document.getElementById('privacy-popup').style.display = 'none';
      } else {
        document.getElementById('privacy-popup').style.display = 'block';
      }

      new Swiper('.beranda-swiper', {
        loop: true,
        pagination: { el: '.swiper-pagination', clickable: true },
        navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
        autoplay: { delay: 3500, disableOnInteraction: false },
        slidesPerView: 1,
        spaceBetween: 0
      });

      document.getElementById('privacy-accept').onclick = function() {
        sessionStorage.setItem('privacyAccepted', 'true');
        document.getElementById('privacy-popup').style.display = 'none';
      };

      document.getElementById('logout-btn').onclick = function() {
        localStorage.clear();
        sessionStorage.clear();
        window.location.href = 'index.html';
      };

      // Hamburger menu toggle pakai class show
      document.getElementById('navbarToggler').onclick = function() {
        const menu = document.getElementById('navbarMobileMenu');
        menu.classList.toggle('show');
      };

      // Logout mobile: tutup menu + logout
      document.getElementById('logout-btn-mobile').onclick = function() {
        toggleMobileMenu();
        localStorage.clear();
        sessionStorage.clear();
        window.location.href = 'index.html';
      };
    });

    function showSection(id) {
      document.querySelectorAll('main section, #contact').forEach(section => section.style.display = 'none');
      const el = document.getElementById(id);
      if (el) el.style.display = 'block';
    }

    function toggleMobileMenu() {
      const menu = document.getElementById('navbarMobileMenu');
      menu.classList.remove('show');
    }

    // --- Firebase Monitoring & Chart.js ---
    // Pastikan sudah ada firebase.initializeApp dan const db = firebase.database(); di atas
    // Data monitoring
    function updateMonitoringUI(data) {
      document.getElementById('temp').textContent = data.suhu || '--';
      document.getElementById('humidity').textContent = data.humidity || '--';
      document.getElementById('current').textContent = data.arus || '--';
      document.getElementById('relay').textContent = (data.relay === 1 || data.relay === '1' || data.relay === true) ? 'ON' : 'OFF';
      document.getElementById('relay').className = 'relay-badge ' + ((data.relay === 1 || data.relay === '1' || data.relay === true) ? 'on' : 'off');
    }
    // Firebase realtime update
    const tempRef = db.ref("sensor/suhu");
    const humRef = db.ref("sensor/humidity");
    const arusRef = db.ref("sensor/arus");
    const relayRef = db.ref("relayStatus");

    tempRef.on('value', (snapshot) => {
      document.getElementById("temp").textContent = snapshot.val();
    });

    humRef.on('value', (snapshot) => {
      document.getElementById("humidity").textContent = snapshot.val();
    });

    arusRef.on('value', (snapshot) => {
      document.getElementById("current").textContent = snapshot.val();
    });

    relayRef.on('value', (snapshot) => {
      const val = snapshot.val();
      let status = val;
      let badge = document.getElementById("relay");
      badge.classList.remove("on", "off");
      if (val === 1 || val === "1" || val === true || val === "ON") {
        status = "ON";
        badge.classList.add("on");
      } else if (val === 0 || val === "0" || val === false || val === "OFF") {
        status = "OFF";
        badge.classList.add("off");
      }
      badge.textContent = status;
    });

    // Chart.js setup
    const chartLabels = [];
    const maxData = 20;
    const suhuData = [];
    const humidityData = [];
    const arusData = [];
    const relayData = [];

    // Chart.js shadow plugin for bold line
    const shadowPlugin = {
      id: 'shadowLine',
      beforeDatasetsDraw(chart) {
        const ctx = chart.ctx;
        chart.data.datasets.forEach((dataset, i) => {
          const meta = chart.getDatasetMeta(i);
          if (!meta.hidden && meta.type === 'line') {
            ctx.save();
            ctx.shadowColor = dataset.borderColor || '#000';
            ctx.shadowBlur = 8;
            ctx.shadowOffsetY = 2;
            ctx.globalAlpha = 0.25;
            ctx.stroke();
            ctx.restore();
          }
        });
      }
    };

    // Chart.js options with tooltip enabled and responsive size
    function getChartOptions(type) {
      let yMin = 0, yMax = 100, step = 10, color = '#000', tickColor = '#000', fontSize = 14, callback = undefined;
      if (type === 'suhu') {
        yMin = 20; yMax = 40; step = 5; color = '#f1c40f'; tickColor = '#a05107'; fontSize = 16;
        callback = function(value) { return [20,25,30,35,40].includes(value) ? value : ''; };
      } else if (type === 'humidity') {
        yMin = 60; yMax = 100; step = 10; color = '#3498db'; tickColor = '#1a4a7c'; fontSize = 16;
      } else if (type === 'arus') {
        yMin = 0.1; yMax = 2; step = 0.2; color = '#27ae60'; tickColor = '#1a7c4a'; fontSize = 16;
      } else if (type === 'relay') {
        yMin = 0; yMax = 1; step = 1; color = '#e74c3c'; tickColor = '#a05107'; fontSize = 16;
      }
      return {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: true },
          tooltip: {
            enabled: true,
            mode: 'nearest',
            intersect: false,
            callbacks: {
              label: function(context) {
                let label = context.dataset.label || '';
                if (label) label += ': ';
                if (context.parsed.y != null) label += context.parsed.y;
                return label;
              }
            }
          }
        },
        scales: {
          y: {
            min: yMin,
            max: yMax,
            grid: { color: color, lineWidth: 2 },
            ticks: {
              stepSize: step,
              color: tickColor,
              font: { weight: 'bold', size: fontSize },
              callback: callback
            }
          },
          x: {
            grid: { color: color+'44', lineWidth: 1.5 },
            ticks: { color: tickColor, font: { size: 14 } }
          }
        }
      };
    }

    // --- Perbaikan chart mobile agar tidak gepeng di device asli ---
    // --- Perbaikan chart mobile agar proporsional di device asli ---
    function setInitialChartCanvasHeight() {
      const isMobile = window.innerWidth <= 768;
      // Gunakan 220px agar tidak terlalu tinggi di mobile
      const chartHeight = isMobile ? 220 : 400;
      ['chart-suhu','chart-humidity','chart-arus','chart-relay'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.removeAttribute('style'); // Hapus style.height agar tidak override
          el.setAttribute('height', chartHeight);
        }
      });
    }
    setInitialChartCanvasHeight();
    window.addEventListener('orientationchange', function() {
      setInitialChartCanvasHeight();
      setTimeout(function(){ location.reload(); }, 200);
    });

    const chartSuhu = new Chart(document.getElementById('chart-suhu').getContext('2d'), {
      type: 'line',
      data: {
        labels: chartLabels,
        datasets: [{
          label: 'Suhu (°C)',
          data: suhuData,
          borderColor: '#e67e22',
          backgroundColor: 'rgba(230,126,34,0.18)',
          fill: true,
          tension: 0.3,
          pointRadius: 4,
          pointHoverRadius: 6,
          borderWidth: 5,
          shadow: true,
        }]
      },
      options: getChartOptions('suhu')
    });
    const chartHumidity = new Chart(document.getElementById('chart-humidity').getContext('2d'), {
      type: 'line',
      data: {
        labels: chartLabels,
        datasets: [{
          label: 'Kelembapan (%)',
          data: humidityData,
          borderColor: '#3498db',
          backgroundColor: 'rgba(52,152,219,0.18)',
          fill: true,
          tension: 0.3,
          pointRadius: 4,
          pointHoverRadius: 6,
          borderWidth: 5,
          shadow: true,
        }]
      },
      options: getChartOptions('humidity')
    });
    const chartArus = new Chart(document.getElementById('chart-arus').getContext('2d'), {
      type: 'line',
      data: {
        labels: chartLabels,
        datasets: [{
          label: 'Arus (mA)',
          data: arusData,
          borderColor: '#27ae60',
          backgroundColor: 'rgba(39,174,96,0.18)',
          fill: true,
          tension: 0.3,
          pointRadius: 4,
          pointHoverRadius: 6,
          borderWidth: 5,
          shadow: true,
        }]
      },
      options: getChartOptions('arus')
    });
    const chartRelay = new Chart(document.getElementById('chart-relay').getContext('2d'), {
      type: 'line',
      data: {
        labels: chartLabels,
        datasets: [{
          label: 'Relay (ON=1, OFF=0)',
          data: relayData,
          borderColor: '#e74c3c',
          backgroundColor: 'rgba(231,76,60,0.18)',
          fill: true,
          tension: 0,
          stepped: true,
          pointRadius: 4,
          pointHoverRadius: 6,
          borderWidth: 5,
          shadow: true,
        }]
      },
      options: getChartOptions('relay')
    });

    function addChartData(label, suhu, humidity, arus, relay) {
      const now = new Date();
      const timeLabel = now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0')+':'+now.getSeconds().toString().padStart(2,'0');
      chartLabels.push(timeLabel);
      suhuData.push(suhu);
      humidityData.push(humidity);
      arusData.push(arus);
      relayData.push(relay);
      if (chartLabels.length > maxData) {
        chartLabels.shift();
        suhuData.shift();
        humidityData.shift();
        arusData.shift();
        relayData.shift();
      }
      chartSuhu.update();
      chartHumidity.update();
      chartArus.update();
      chartRelay.update();
    }

    // Listen to Firebase and update chart every time data changes
    let lastSuhu = null, lastHumidity = null, lastArus = null, lastRelay = null;
    function tryAddChart() {
      if (lastSuhu !== null && lastHumidity !== null && lastArus !== null && lastRelay !== null) {
        addChartData('', lastSuhu, lastHumidity, lastArus, lastRelay);
      }
    }
    tempRef.on('value', (snapshot) => {
      lastSuhu = Number(snapshot.val());
      tryAddChart();
    });
    humRef.on('value', (snapshot) => {
      lastHumidity = Number(snapshot.val());
      tryAddChart();
    });
    arusRef.on('value', (snapshot) => {
      lastArus = Number(snapshot.val());
      tryAddChart();
    });
    relayRef.on('value', (snapshot) => {
      let val = snapshot.val();
      lastRelay = (val === 1 || val === "1" || val === true || val === "ON") ? 1 : 0;
      tryAddChart();
    });
  </script>

  <style>
    * {
      box-sizing: border-box;
    }
    :root {
      font-size: 16px;
    }
    .beranda-content {
      padding-left: 2vw;
      padding-right: 2vw;
      padding-top: 2rem;
      padding-bottom: 2rem;
    }
    .beranda-content h2 {
      font-size: 2rem;
      margin-bottom: 2rem;
    }
    .artikel-container.card {
      padding: 1.2rem 2rem;
    }
    .artikel-content h3 {
      font-size: 1.3rem;
    }
    .artikel-content p {
      font-size: 1rem;
    }
    .barcode-section .barcode-img {
      max-width: 60%;
      height: auto;
    }
    .swiper {
      min-height: 260px;
      height: 480px;
      max-height: 540px;
      border-radius: 1.2rem;
    }
    @media (min-width: 769px) {
      .swiper {
        min-height: 380px;
        height: 520px;
        max-height: 600px;
      }
      .swiper-slide img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        object-position: center;
        border-radius: 1.2rem;
        background: #f8f8f8;
        max-height: 520px;
        max-width: 100%;
        box-shadow: none;
      }
    }
    @media (max-width: 768px) {
      .swiper {
        min-height: 180px;
        height: 260px;
        max-height: 320px;
      }
      .swiper-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        border-radius: 0.7rem;
        background: #f8f8f8;
        max-height: 260px;
        max-width: 100vw;
      }
    }
    /* Khusus slide kedua dan ketiga: pastikan gambar berita tidak terpotong di desktop */
    @media (min-width: 769px) {
      .swiper-slide:nth-child(2) img,
      .swiper-slide:nth-child(3) img {
        object-fit: contain !important;
        background: #f8f8f8;
        max-height: 520px;
      }
    }
    @media (max-width: 768px) {
      .swiper-slide:nth-child(2) img,
      .swiper-slide:nth-child(3) img {
        object-fit: cover !important;
        max-height: 260px;
      }
    }
    /* Untuk smartphone */
    @media (min-width: 768px) {
      .beranda-content {
        padding-left: 3vw;
        padding-right: 3vw;
        padding-top: 1.2rem;
        padding-bottom: 1.2rem;
      }
      .row.justify-content-center.mb-4 > .col-12.col-md-10.col-lg-8 {
        margin-left: auto;
        margin-right: auto;
        float: none;
      }
      .artikel-container.card {
        margin-left: auto;
        margin-right: auto;
        float: none;
        width: 100%;
        max-width: 98vw;
      }
      .artikel-content.card-body {
        text-align: justify;
        margin-left: auto;
        margin-right: auto;
        float: none;
        width: 100%;
        max-width: 98vw;
        box-sizing: border-box;
      }
    }
    /* Untuk desktop */
    @media (min-width: 769px) {
      .beranda-content {
        padding-left: 6vw;
        padding-right: 6vw;
        padding-top: 2.5rem;
        padding-bottom: 2.5rem;
      }
      .beranda-content h2 {
        font-size: 2.2rem;
      }
      .artikel-content h3 {
        font-size: 1.3rem;
      }
      .artikel-content p {
        font-size: 1.05rem;
      }
      .barcode-section .barcode-img {
        max-width: 60%;
      }
      .swiper {
        min-height: 18vw;
      }
      .menu {
        display: flex;
        font-size: 1.13rem;
      }
    }
    /* Untuk smartphone 375px */
    @media (max-width: 400px) {
      html, body {
        width: 100vw;
        min-width: 0;
        max-width: 100vw;
        overflow-x: hidden;
      }
      .beranda-content {
        padding-left: 2vw;
        padding-right: 2vw;
        padding-top: 0.7rem;
        padding-bottom: 0.7rem;
      }
      .row.justify-content-center.mb-4 > .col-12.col-md-10.col-lg-8 {
        margin-left: 0 !important;
        margin-right: 0 !important;
        float: none;
        width: 100vw;
        max-width: 100vw;
        padding: 0;
      }
      .artikel-container.card {
        padding: 0.7rem 0.5rem;
        margin-left: 0 !important;
        margin-right: 0 !important;
        width: 100vw;
        max-width: 100vw;
        box-sizing: border-box;
      }
      .artikel-content.card-body {
        font-size: 0.93rem;
        padding: 0;
        margin: 0 auto;
        width: 100vw;
        max-width: 100vw;
        box-sizing: border-box;
        text-align: justify;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .artikel-content.card-body > * {
        width: 100%;
        max-width: 100%;
      }
      .artikel-content h3 {
        font-size: 0.98rem;
        margin-bottom: 0.7rem;
        text-align: center;
      }
      .artikel-content p {
        font-size: 0.93rem;
        margin-bottom: 0.5rem;
        text-align: justify;
      }
      .barcode-section .barcode-img {
        max-width: 90vw;
        margin-left: auto;
        margin-right: auto;
        display: block;
      }
      .swiper {
        min-height: 120px;
        border-radius: 0.7rem;
      }
      .row.justify-content-center.mb-4 > .col-12.col-md-10.col-lg-8 {
        margin-left: auto;
        margin-right: auto;
        float: none;
        width: 100%;
        max-width: 99vw;
      }
      .card img {
        max-width: 100%;
        height: auto;
        display: block;
      }
      .navbar ul {
        flex-direction: column;
        align-items: stretch;
        padding-left: 0;
        margin-bottom: 0.5rem;
      }
      .navbar ul li {
        width: 100%;
        text-align: center;
        margin-bottom: 0.2rem;
      }
      .navbar ul li a {
        font-size: 0.98rem;
        padding: 0.5rem 0;
        display: block;
      }
      .sidebar-bawah {
        font-size: 0.93rem;
        padding: 0.7rem 0.3rem;
      }
      .anggota-tim {
        flex-direction: column;
        align-items: center;
      }
      .anggota-item {
        width: 90vw;
        max-width: 350px;
        min-width: 0;
        margin-bottom: 0.7rem;
        background: #fffbe6;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(241,196,15,0.10);
        padding: 1rem 0.5rem 0.7rem 0.5rem;
        text-align: center;
        overflow: visible;
      }
      .anggota-item img {
        max-width: 70px;
        border-radius: 12px;
        margin-bottom: 0.5rem;
      }
      .anggota-item div {
        font-size: 1.05rem;
        white-space: normal;
        overflow: visible;
        text-overflow: unset;
      }
      .anggota-item div:nth-child(2) {
        font-weight: 600;
        margin-bottom: 0.2rem;
      }
      .anggota-item div:nth-child(3) {
        font-size: 0.98rem;
        color: #a05107;
        margin-bottom: 0;
      }
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .header {
      background: #e0e0e0;
      padding: 12px 16px;
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      flex-wrap: nowrap;
      gap: 0;
      position: relative;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      justify-content: flex-start;
    }
    .logo-img {
      max-height: 48px;
      width: auto;
      border-radius: 8px;
    }
    .navbar-toggler {
      display: none;
      background: none;
      border: none;
      outline: none;
      padding: 0 8px;
      height: 40px;
      width: 44px;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1001;
    }
    .navbar-toggler .bar {
      display: block;
      width: 30px;
      height: 4px;
      background: #111;
      margin: 5px 0;
      border-radius: 2px;
      transition: all 0.2s;
    }
    /* Untuk artikel konten di mobile */
    @media (max-width: 767px) {
      .artikel-container.card,
      .artikel-content.card-body {
        width: 100%;
        max-width: 100vw;
        margin: 0 auto;
        padding: 0.7rem 0.5rem;
        box-sizing: border-box;
        overflow-x: hidden;
      }
      .artikel-content.card-body {
        word-break: break-word;
        overflow-wrap: break-word;
      }
      .artikel-content.card-body > * {
        width: 100%;
        max-width: 100%;
      }
    }
    /* Chart.js canvas responsive desktop */
    @media (min-width: 769px) {
      #chart-suhu,
      #chart-humidity,
      #chart-arus,
      #chart-relay {
        height: 400px !important;
        min-height: 320px !important;
        max-height: 480px !important;
        width: 100% !important;
        display: block;
        margin: 0 auto 24px auto;
        cursor: pointer;
      }
    }
    /* Chart.js canvas mobile */
    @media (max-width: 768px) {
      #chart-suhu,
      #chart-humidity,
      #chart-arus,
      #chart-relay {
        width: 100% !important;
        display: block;
        margin: 0 auto 16px auto;
        cursor: pointer;
        background: #fffbe6;
        border-radius: 12px;
        /* height diatur lewat atribut, bukan CSS! */
        max-height: 260px !important;
        min-height: 180px !important;
      }
    }
    /* Swiper image fit for desktop */
    @media (min-width: 769px) {
      .swiper-slide img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        object-position: center;
        border-radius: 1.2rem;
        background: #f8f8f8;
        max-height: 420px;
        max-width: 100%;
        box-shadow: none;
      }
    }
    /* Swiper image fit for mobile */
    @media (max-width: 768px) {
      .swiper-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        border-radius: 0.7rem;
        background: #f8f8f8;
        max-height: 220px;
        max-width: 100vw;
      }
    }
    /* Khusus slide kedua: pastikan gambar berita tidak terpotong di desktop */
    @media (min-width: 769px) {
      .swiper-slide:nth-child(2) img {
        object-fit: contain !important;
        background: #f8f8f8;
        max-height: 420px;
      }
    }
    @media (max-width: 768px) {
      .swiper-slide:nth-child(2) img {
        object-fit: cover !important;
        max-height: 220px;
      }
    }
    .anggota-item img {
      max-width: 110px;
      max-height: 110px;
      width: 110px;
      height: 110px;
      border-radius: 50%;
      object-fit: contain;
      margin-bottom: 0.5rem;
      background: #fffbe6;
      box-shadow: 0 2px 8px rgba(241,196,15,0.10);
    }
    .anggota-item div {
      font-size: 1.05rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      text-align: center;
    }
  </style>
</body>
</html>
